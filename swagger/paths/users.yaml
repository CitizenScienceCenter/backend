paths:
  user_reset:
    get:
      tags: [Users]
      operationId: api.user.custom.reset
      summary: Reset user password
      parameters:
        - name: email
          in: query
          required: true
          type: string
      responses:
        200:
          description: Password reset
    post:
      tags: [Users]
      operationId: api.user.custom.verify_reset
      summary: Verify password reset token
      parameters:
        - name: reset
          in: body
          schema:
            type: object
            required:
              - token
              - pwd
              - id
            properties:
              id:
                type: string
              token:
                type: string
              pwd:
                type: string
      responses:
        200:
          description: Verified and reset
        401:
          description: Unauthorised user
  user_id_submissions:
    get:
      security:
         - apiKeyHeader: []
         - anonUser: []
      tags: [Users]
      operationId: api.user.custom.get_subs
      summary: Get all submissions for a user (or those matching an ID)
      parameters:
        - {$ref: './params.yaml#/parameters/id'}
      responses:
        200:
          description: Return submissions
          schema:
            type: array
            items:
              {$ref: './types.yaml#/definitions/Submission'}
        404:
          description: User not found
  user_login:
    post:
      tags: [Users]
      operationId: api.user.custom.login
      summary: Allow a user to login
      parameters:
        - name: user
          in: body
          required: true
          schema:
            {$ref: './types.yaml#/definitions/User'}
      responses:
        200:
          description: Login successful
        401:
          description: Incorrect login details
        404:
          description: User not found
  user_authorize:
    post:
      tags: [Users]
      operationId: api.otoken.generate
      summary: Post auth for token response
      parameters:
        - name: token
          in: body
          schema:
            {$ref: './types.yaml#/definitions/Otoken'}
      responses:
        200:
          description: Token created
  user_validate:
    get:
      tags: [Users]
      summary: OAuth2 token info
      operationId: api.user.custom.validate
      parameters:
        - name: key
          in: query
          type: string
      responses:
        200:
          description: Token info object
          schema:
            {$ref: './types.yaml#/definitions/User'}
  user_id:
    get:
      security:
         - apiKeyHeader: []
         - anonUser: []
      tags: [Users]
      operationId: api.user.model.get_one
      summary: Get all users (or those matching an ID)
      parameters:
        - {$ref: './params.yaml#/parameters/id'}
      responses:
        200:
          description: Return users
          schema:
            {$ref: './types.yaml#/definitions/User'}
        404:
          description: User not found
    put:
      security:
        - apiKeyHeader: []
        - anonUser: []
      tags: [Users]
      operationId: api.user.model.put
      summary: Update user details (change password, add details etc)
      parameters:
        - {$ref: './params.yaml#/parameters/id'}
        - name: user
          in: body
          schema:
            {$ref: './types.yaml#/definitions/User'}
      responses:
        201:
          description: User updated
          schema:
            {$ref: './types.yaml#/definitions/User'}
        404:
          description: User not found
  register_user:
    post:
      tags: [Users]
      summary: Registration end point for a user account
      operationId: api.user.model.post
      parameters:
        - name: user
          in: body
          schema:
            {$ref: './types.yaml#/definitions/User'}
      responses:
        200:
          description: Created user
  get_users:
    get:
      tags: [Users]
      security:
        - oauth2: []
      operationId: api.user.model.get_all
      parameters:
        - name: search_term
          in: query
          type: string
        - name: limit
          in: query
          type: integer
          minimum: 0
          default: 20
      responses:
        200:
          description: Return all users
          schema:
            type: array
            items:  
              {$ref: './types.yaml#/definitions/User'}
    